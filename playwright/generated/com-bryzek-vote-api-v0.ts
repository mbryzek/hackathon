/**
 * TypeScript types for vote-api
 * Based on API Builder specification at com.bryzek.vote.api.v0
 *
 * Generated by API Builder - do not edit manually
 */

import type { ISODateTimeString } from './generated-types';

// ============================================================================
// Enums
// ============================================================================

export enum EventStatus {
  Draft = 'draft',
  Open = 'open',
  Closed = 'closed',
}

export enum VoterType {
  Student = 'student',
  Parent = 'parent',
}

// ============================================================================
// Models
// ============================================================================

/**
 * Form to verify a voting code
 */
export interface CodeVerificationForm {
  /** 6-digit voting code */
  code: string;
}

/**
 * A voting event
 */
export interface Event {
  id: string;
  key: string;
  name: string;
  status: EventStatus;
  created_at: ISODateTimeString;
  updated_at: ISODateTimeString;
}

export interface EventReference {
  id: string;
}

/**
 * A project
 */
export interface Project {
  id: string;
  event: EventReference;
  name: string;
  description?: string;
  position: number;
  created_at: ISODateTimeString;
  updated_at: ISODateTimeString;
}

/**
 * A project with its voting state
 */
export interface ProjectVote {
  project: Project;
  /** Whether this project has been voted for by the current code */
  selected: boolean;
}

/**
 * Response after verifying a voting code
 */
export interface Vote {
  voter_type: VoterType;
  /** Maximum number of votes allowed (1 for students, 3 for parents) */
  max_votes: number;
  event: Event;
  projects: ProjectVote[];
}

/**
 * Form to submit votes
 */
export interface VoteForm {
  /** 6-digit voting code */
  code: string;
  /** IDs of projects to vote for */
  project_ids: string[];
}

// ============================================================================
// API Client
// ============================================================================

import { VoidResponse } from './generated-error-void-response.ts';
import { ValidationErrorsResponse } from './generated-error-validation-errors-response.ts';
import { ApiException } from "./generated-util.ts";

export interface GetAllEventsOpenOptions {
  headers?: Record<string, string>;
}

export interface CreateVoteCodeAndVerificationsOptions {
  eventKey: string;
  body: CodeVerificationForm;
  headers?: Record<string, string>;
}

export interface CreateVoteOptions {
  eventKey: string;
  body: VoteForm;
  headers?: Record<string, string>;
}

export class ApiClient {
  private baseUrl: string;

  constructor(baseUrl: string) {
    this.baseUrl = baseUrl;
  }

  async getAllEventsOpen(params: GetAllEventsOpenOptions): Promise<Event[]> {
    const url = `${this.baseUrl}/vote/events/all/open`;

      const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        ...(params.headers || {}),
      },
    });

    if (response.status === 200) {
      const data = await response.json();
      return data;
    }

    throw new ApiException(response, `Request failed with status ${response.status}`);

  }

  async createVoteCodeAndVerifications(params: CreateVoteCodeAndVerificationsOptions): Promise<Vote> {
    const url = `${this.baseUrl}/vote/events/${params.eventKey}/code/verifications`;

      const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(params.headers || {}),
      },
      body: JSON.stringify(params.body),
    });

    if (response.status === 200) {
      const data = await response.json();
      return data;
    }

    if (response.status === 404) {
      throw new VoidResponse(response);
    }

    if (response.status === 422) {
      throw new ValidationErrorsResponse(response);
    }

    throw new ApiException(response, `Request failed with status ${response.status}`);

  }

  async createVote(params: CreateVoteOptions): Promise<Vote> {
    const url = `${this.baseUrl}/vote/events/${params.eventKey}`;

      const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        ...(params.headers || {}),
      },
      body: JSON.stringify(params.body),
    });

    if (response.status === 200) {
      const data = await response.json();
      return data;
    }

    if (response.status === 404) {
      throw new VoidResponse(response);
    }

    if (response.status === 422) {
      throw new ValidationErrorsResponse(response);
    }

    throw new ApiException(response, `Request failed with status ${response.status}`);

  }

}